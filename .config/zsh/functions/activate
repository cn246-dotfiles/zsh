local venv_base_dir
venv_base_dir="$HOME/.local/lib/venv"

local selected_env
selected_env=$(ls "${venv_base_dir}" | fzf --height=50% \
                                           --margin=5%,2%,2%,5% \
                                           --border=sharp \
                                           --border-label='Select Venv to Activate' \
                                           --header='CTRL-c or ESC to quit')

if [[ -n "${selected_env}" ]]; then
  venv_path="${venv_base_dir}/${selected_env}"
else
  return 0
fi

if [ -d "${venv_path}" ]; then
  source "${venv_path}/bin/activate"

  if [ ${venv_path} = "${venv_base_dir}/ansible" ]; then
    eval $(register-python-argcomplete ansible)
    eval $(register-python-argcomplete ansible-config)
    eval $(register-python-argcomplete ansible-console)
    eval $(register-python-argcomplete ansible-doc)
    eval $(register-python-argcomplete ansible-galaxy)
    eval $(register-python-argcomplete ansible-inventory)
    eval $(register-python-argcomplete ansible-playbook)
    eval $(register-python-argcomplete ansible-pull)
    eval $(register-python-argcomplete ansible-vault)
  fi

  unset selected_env venv_path
fi

# vim: ft=zsh ts=2 sts=2 sw=2 sr et
